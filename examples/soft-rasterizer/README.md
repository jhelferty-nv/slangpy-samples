# Soft Triangle Rasterizer

This example takes the forward rasterizer example (fwd-rasterizer) with color
dependent on boolean inside/outside value, and turns it into a soft triangle
rasterizer with fuzzy edges. It then extends it to show how to use autodiff to
recover the vertex parameters of a pre-rendered triangle.

## Overview

This example:

- Generates a reference soft triangle image
- Assigns initial vertex parameters values (to be trained to the reference)
- Loop epochs of gradient descent:
    - For each pixel coordinate:
        - Get a reference image sample
        - Calculate a sample based on this epoch's vertex parameters
        - Calculate Loss between the epoch pixel and the reference pixel
        - bwd_diff(loss) to generate gradients, and accumulate them into a
            tensor
    - Optimize the vertex parameters using the gradients (gradient descent)
    - Display a triangle using this epoch's vertex parameters

## Architecture Notes

### Convergence

While the triangle appears as a solid green region with a soft edge, the actual
data generated by the rasterizer extends outside of the visual (0, 1) range.
These values allow for a gradient across all samples, allowing the gradients to
converge.

### Atomic Gradient Writes

The example accumulates gradients from many samples into three vertices
simultaneously across multiple threads. To avoid overwriting and invalidating
the gradient values, the example uses an AtomicTensor to force the use of
atomic writes.

## Output Example

![Output visualization](output.png)

_Visualization showing the converged output vertex parameters._

## Usage

Call the main.py script with ``--help`` or ``-h`` for optional arguments.
Output is visualized in the app window, but the actual triangle vertex values
and gradients per-vertex can be logged by using the ``--log`` or ``-l`` option.

Default values converge, but it's possible to specify parameters that do not,
particularly if the vertices are close together or if the reference triangle's
coordinates fall outside of the (-0.9, 0.9) range.

